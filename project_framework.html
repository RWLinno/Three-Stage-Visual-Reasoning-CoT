<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSVR-CoT é¡¹ç›®æ¡†æ¶å›¾</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 40px;
            font-size: 2.5em;
        }
        .architecture {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        .layer {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #667eea;
        }
        .layer-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .icon {
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #667eea;
            color: white;
            border-radius: 50%;
            font-weight: bold;
        }
        .modules {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .module {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }
        .module:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        .module-name {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        .module-desc {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
        }
        .flow {
            margin-top: 40px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 30px;
            border-radius: 15px;
        }
        .flow-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
            margin-bottom: 25px;
            text-align: center;
        }
        .flow-diagram {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 20px;
        }
        .stage {
            flex: 1;
            min-width: 250px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
        }
        .stage-number {
            position: absolute;
            top: -15px;
            left: 20px;
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        .stage-title {
            font-weight: bold;
            color: #333;
            margin-top: 10px;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        .stage-content {
            color: #666;
            font-size: 0.9em;
            line-height: 1.6;
        }
        .stage-output {
            margin-top: 12px;
            padding: 10px;
            background: #f0f4ff;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }
        .stage-output-title {
            font-weight: bold;
            color: #667eea;
            font-size: 0.85em;
            margin-bottom: 5px;
        }
        .stage-output-list {
            font-size: 0.8em;
            color: #555;
            line-height: 1.5;
        }
        .arrow {
            font-size: 2em;
            color: #667eea;
            align-self: center;
        }
        .validation-loop {
            margin-top: 20px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
        }
        .validation-loop-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 8px;
        }
        .tech-stack {
            margin-top: 40px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .tech-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.3s;
        }
        .tech-item:hover {
            transform: scale(1.05);
        }
        .tech-name {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 8px;
        }
        .tech-version {
            font-size: 0.9em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ€ TSVR-CoT é¡¹ç›®æ¡†æ¶å›¾</h1>
        
        <!-- ç³»ç»Ÿæ¶æ„ -->
        <div class="architecture">
            <!-- Layer 1: æ ¸å¿ƒå¼•æ“å±‚ -->
            <div class="layer">
                <div class="layer-title">
                    <span class="icon">1</span>
                    æ ¸å¿ƒå¼•æ“å±‚ (Core Engine Layer)
                </div>
                <div class="modules">
                    <div class="module">
                        <div class="module-name">CoT Engine</div>
                        <div class="module-desc">
                            <strong>æ–‡ä»¶:</strong> src/base/cot_engine.py<br>
                            <strong>åŠŸèƒ½:</strong> ä¸‰é˜¶æ®µCoTæ¨ç†æµç¨‹æ§åˆ¶<br>
                            <strong>æ–°å¢:</strong> éªŒè¯-é‡æ¨ç†å¾ªç¯æœºåˆ¶<br>
                            <strong>æ–°å¢:</strong> æ¨¡å¼æå–ä¸çŠ¶æ€æ£€æŸ¥
                        </div>
                    </div>
                    <div class="module">
                        <div class="module-name">VLM Agent</div>
                        <div class="module-desc">
                            <strong>æ–‡ä»¶:</strong> src/base/vlm_agent.py<br>
                            <strong>åŠŸèƒ½:</strong> EAS APIè°ƒç”¨å°è£…<br>
                            <strong>æ”¯æŒ:</strong> å›¾åƒ+æ–‡æœ¬å¤šæ¨¡æ€è¾“å…¥<br>
                            <strong>æ”¯æŒ:</strong> é‡è¯•æœºåˆ¶å’Œé”™è¯¯å¤„ç†
                        </div>
                    </div>
                    <div class="module">
                        <div class="module-name">Validation Engine</div>
                        <div class="module-desc">
                            <strong>æ–‡ä»¶:</strong> src/base/validation.py<br>
                            <strong>åŠŸèƒ½:</strong> å¤šç­–ç•¥éªŒè¯æœºåˆ¶<br>
                            <strong>åŒ…å«:</strong> åé—®å¼éªŒè¯ã€è§†è§‰æ¨ç†éªŒè¯
                        </div>
                    </div>
                </div>
            </div>

            <!-- Layer 2: æç¤ºæ¨¡æ¿å±‚ -->
            <div class="layer">
                <div class="layer-title">
                    <span class="icon">2</span>
                    æç¤ºæ¨¡æ¿å±‚ (Prompt Template Layer)
                </div>
                <div class="modules">
                    <div class="module">
                        <div class="module-name">Task Templates</div>
                        <div class="module-desc">
                            <strong>æ–‡ä»¶:</strong> src/utils/prompt_templates.py<br>
                            <strong>åŠŸèƒ½:</strong> ä»»åŠ¡ç‰¹å®šçš„promptæ¨¡æ¿<br>
                            <strong>æ”¯æŒ:</strong> washer_knob, generic_visual<br>
                            <strong>é‡æ„:</strong> Stage3å‡ ä½•éªŒè¯prompt
                        </div>
                    </div>
                    <div class="module">
                        <div class="module-name">Stage1: Rule Extraction</div>
                        <div class="module-desc">
                            <strong>ä»»åŠ¡:</strong> å‡ ä½•è§„åˆ™æå–<br>
                            <strong>è¦æ±‚:</strong> æ—‹é’®ä¸­å¿ƒã€åŠå¾„ã€æŒ‡é’ˆè§’åº¦ã€åˆ»åº¦çº¿ä½ç½®<br>
                            <strong>è¾“å‡º:</strong> ç»“æ„åŒ–å‡ ä½•ä¿¡æ¯
                        </div>
                    </div>
                    <div class="module">
                        <div class="module-name">Stage2: Application</div>
                        <div class="module-desc">
                            <strong>ä»»åŠ¡:</strong> åº”ç”¨è§„åˆ™æ¨ç†ç­”æ¡ˆ<br>
                            <strong>è¾“å…¥:</strong> Stage1è§„åˆ™ + å›¾åƒ<br>
                            <strong>è¾“å‡º:</strong> åˆæ­¥ç­”æ¡ˆ (å¸¦&lt;answer&gt;æ ‡ç­¾)
                        </div>
                    </div>
                    <div class="module">
                        <div class="module-name">Stage3: Geometric Validation</div>
                        <div class="module-desc">
                            <strong>ä»»åŠ¡:</strong> ä¸¥æ ¼å‡ ä½•éªŒè¯<br>
                            <strong>æµ‹è¯•:</strong> å…±çº¿æ€§ã€æœ€è¿‘åˆ»åº¦çº¿ã€é‚»è¿‘æ¨¡å¼<br>
                            <strong>é˜ˆå€¼:</strong> 5åº¦è§’åº¦å®¹å·®
                        </div>
                    </div>
                </div>
            </div>

            <!-- Layer 3: å¯è§†åŒ–å±‚ -->
            <div class="layer">
                <div class="layer-title">
                    <span class="icon">3</span>
                    å¯è§†åŒ–å±‚ (Visualization Layer)
                </div>
                <div class="modules">
                    <div class="module">
                        <div class="module-name">Geometry Visualization</div>
                        <div class="module-desc">
                            <strong>æ–‡ä»¶:</strong> src/utils/visualization.py<br>
                            <strong>æ–°å¢:</strong> draw_auxiliary_lines_on_image()<br>
                            <strong>åŠŸèƒ½:</strong> PILç›´æ¥ç»˜åˆ¶è¾…åŠ©çº¿<br>
                            <strong>è¾“å‡º:</strong> *_stage1_auxiliary.jpg
                        </div>
                    </div>
                    <div class="module">
                        <div class="module-name">JSON Storage</div>
                        <div class="module-desc">
                            <strong>æ–°å¢:</strong> save_geometric_info_to_json()<br>
                            <strong>è¾“å‡º:</strong> stage1_geometry.json<br>
                            <strong>è¾“å‡º:</strong> stage2_answer.json<br>
                            <strong>è¾“å‡º:</strong> stage3_validation.json
                        </div>
                    </div>
                    <div class="module">
                        <div class="module-name">HTML Report Generator</div>
                        <div class="module-desc">
                            <strong>æ–‡ä»¶:</strong> scripts/generate_html_report.py<br>
                            <strong>ä¼˜åŒ–:</strong> ç§»é™¤ä¸­æ–‡æ ‡ç­¾<br>
                            <strong>åŠŸèƒ½:</strong> äº¤äº’å¼ç»“æœå±•ç¤º
                        </div>
                    </div>
                </div>
            </div>

            <!-- Layer 4: åº”ç”¨å±‚ -->
            <div class="layer">
                <div class="layer-title">
                    <span class="icon">4</span>
                    åº”ç”¨å±‚ (Application Layer)
                </div>
                <div class="modules">
                    <div class="module">
                        <div class="module-name">Washer Knob Analyzer</div>
                        <div class="module-desc">
                            <strong>æ–‡ä»¶:</strong> scripts/washer_knob_analyzer.py<br>
                            <strong>åŠŸèƒ½:</strong> æ´—è¡£æœºæ—‹é’®åˆ†æä¸»ç¨‹åº<br>
                            <strong>æ”¯æŒ:</strong> å‘½ä»¤è¡Œå‚æ•°ã€æ‰¹é‡å¤„ç†
                        </div>
                    </div>
                    <div class="module">
                        <div class="module-name">CoT Evaluator</div>
                        <div class="module-desc">
                            <strong>æ–‡ä»¶:</strong> scripts/cot_evaluator.py<br>
                            <strong>åŠŸèƒ½:</strong> è¯„ä¼°ç³»ç»Ÿæ€§èƒ½<br>
                            <strong>æŒ‡æ ‡:</strong> å‡†ç¡®ç‡ã€ç½®ä¿¡åº¦ã€å¤„ç†æ—¶é—´
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¨ç†æµç¨‹ -->
        <div class="flow">
            <div class="flow-title">ä¸‰é˜¶æ®µCoTæ¨ç†æµç¨‹</div>
            <div class="flow-diagram">
                <div class="stage">
                    <div class="stage-number">1</div>
                    <div class="stage-title">è§„åˆ™æå–</div>
                    <div class="stage-content">
                        åˆ†æå›¾åƒå‡ ä½•ç‰¹å¾,æå–åˆ¤æ–­è§„åˆ™
                    </div>
                    <div class="stage-output">
                        <div class="stage-output-title">è¾“å‡º:</div>
                        <div class="stage-output-list">
                            â€¢ æ—‹é’®ä¸­å¿ƒåæ ‡<br>
                            â€¢ æ—‹é’®åŠå¾„<br>
                            â€¢ çº¢è‰²æŒ‡é’ˆè§’åº¦<br>
                            â€¢ ç»¿è‰²åˆ»åº¦çº¿åˆ—è¡¨<br>
                            â€¢ å¯¹é½è§„åˆ™
                        </div>
                    </div>
                </div>
                
                <div class="arrow">â†’</div>
                
                <div class="stage">
                    <div class="stage-number">2</div>
                    <div class="stage-title">åº”ç”¨æ¨ç†</div>
                    <div class="stage-content">
                        åŸºäºè§„åˆ™æ¨å¯¼å½“å‰æ¡£ä½
                    </div>
                    <div class="stage-output">
                        <div class="stage-output-title">è¾“å‡º:</div>
                        <div class="stage-output-list">
                            â€¢ åˆæ­¥ç­”æ¡ˆ<br>
                            â€¢ æ¨ç†è¿‡ç¨‹<br>
                            â€¢ è§’åº¦è®¡ç®—
                        </div>
                    </div>
                </div>
                
                <div class="arrow">â†’</div>
                
                <div class="stage">
                    <div class="stage-number">3</div>
                    <div class="stage-title">å‡ ä½•éªŒè¯</div>
                    <div class="stage-content">
                        ä¸¥æ ¼éªŒè¯ç­”æ¡ˆçš„å‡ ä½•æ­£ç¡®æ€§
                    </div>
                    <div class="stage-output">
                        <div class="stage-output-title">éªŒè¯æµ‹è¯•:</div>
                        <div class="stage-output-list">
                            âœ“ å…±çº¿æ€§æµ‹è¯• (5åº¦å®¹å·®)<br>
                            âœ“ æœ€è¿‘åˆ»åº¦çº¿æµ‹è¯•<br>
                            âœ“ é‚»è¿‘æ¨¡å¼æ£€æŸ¥<br>
                            â†’ VALID / INVALID
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="validation-loop">
                <div class="validation-loop-title">ğŸ”„ éªŒè¯-é‡æ¨ç†å¾ªç¯</div>
                <div style="color: #856404; font-size: 0.9em; line-height: 1.6;">
                    â€¢ å¦‚æœStage3éªŒè¯å¤±è´¥ â†’ è®°å½•é”™è¯¯åŸå› <br>
                    â€¢ è¿”å›Stage2é‡æ–°æ¨ç† (å¸¦å¤±è´¥æç¤º)<br>
                    â€¢ æœ€å¤šé‡è¯•2æ¬¡<br>
                    â€¢ å¦‚æœ‰å»ºè®®ç­”æ¡ˆå¯ç›´æ¥é‡‡ç”¨<br>
                    â€¢ è®°å½•æ‰€æœ‰å°è¯•åˆ°retry_history
                </div>
            </div>
        </div>

        <!-- æŠ€æœ¯æ ˆ -->
        <div class="tech-stack">
            <div class="tech-item">
                <div class="tech-name">Python</div>
                <div class="tech-version">3.8+</div>
            </div>
            <div class="tech-item">
                <div class="tech-name">PIL/Pillow</div>
                <div class="tech-version">å›¾åƒå¤„ç†</div>
            </div>
            <div class="tech-item">
                <div class="tech-name">OpenCV</div>
                <div class="tech-version">å‡ ä½•æ£€æµ‹</div>
            </div>
            <div class="tech-item">
                <div class="tech-name">Matplotlib</div>
                <div class="tech-version">å¯è§†åŒ–</div>
            </div>
            <div class="tech-item">
                <div class="tech-name">NumPy</div>
                <div class="tech-version">æ•°å€¼è®¡ç®—</div>
            </div>
            <div class="tech-item">
                <div class="tech-name">Qwen-VL</div>
                <div class="tech-version">235B å¤šæ¨¡æ€æ¨¡å‹</div>
            </div>
        </div>
    </div>
</body>
</html>

